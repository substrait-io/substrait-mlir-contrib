# RUN: substrait-translate -protobuf-to-substrait %s \
# RUN:   --split-input-file="# ""-----" \
# RUN: | FileCheck %s

# RUN: substrait-translate -protobuf-to-substrait %s \
# RUN:   --split-input-file="# ""-----" --output-split-marker="// -----" \
# RUN: | substrait-translate -substrait-to-protobuf \
# RUN:   --split-input-file --output-split-marker="# ""-----" \
# RUN: | substrait-translate -protobuf-to-substrait \
# RUN:   --split-input-file="# ""-----" --output-split-marker="// -----" \
# RUN: | FileCheck %s

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.list<!substrait.fixed_binary<4>>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            list {
              type {
                fixed_binary {
                  length: 4
                  nullability: NULLABILITY_REQUIRED
                }
              }
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.decimal<12, 3>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            decimal {
              nullability: NULLABILITY_REQUIRED
              precision: 12
              scale: 3
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.fixed_binary<5>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            fixed_binary {
              length: 5
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.fixed_binary<5>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            fixed_binary {
              length: 5
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.var_char<6>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            varchar {
              length: 6
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.fixed_char<5>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            fixed_char {
              length: 5
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# RUN: substrait-translate -protobuf-to-substrait %s \
# RUN:   --split-input-file="# ""-----" --output-split-marker="// -----" \
# RUN: | substrait-translate -substrait-to-protobuf \
# RUN:   --split-input-file --output-split-marker="# ""-----" \
# RUN: | substrait-translate -protobuf-to-substrait \
# RUN:   --split-input-file="# ""-----" --output-split-marker="// -----" \
# RUN: | FileCheck %s

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.uuid>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            uuid {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.interval_year_month, !substrait.interval_day_second>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        names: "b"
        struct {
          types {
            interval_year {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            interval_day {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.time>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            time {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.date>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            date {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.timestamp, !substrait.timestamp_tz>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        names: "b"
        struct {
          types {
            timestamp {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            timestamp_tz {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.binary>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            binary {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<!substrait.string>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        struct {
          types {
            string {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<f32, f64>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        names: "b"
        struct {
          types {
            fp32 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            fp64 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<f32, tuple<f32>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        names: "b"
        names: "c"
        struct {
          types {
            fp32 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            struct {
              types {
                fp32 {
                  nullability: NULLABILITY_REQUIRED
                }
              }
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<si1, si8, si16, si32, si64>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        names: "b"
        names: "c"
        names: "d"
        names: "e"
        struct {
          types {
            bool {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            i8 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            i16 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            i32 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            i64 {
              nullability: NULLABILITY_REQUIRED
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}

# -----

# CHECK:      substrait.plan
# CHECK-NEXT:   relation
# CHECK-NEXT:     named_table
# CHECK-SAME:       : tuple<si1, tuple<si1>>

relations {
  rel {
    read {
      common {
        direct {
        }
      }
      base_schema {
        names: "a"
        names: "b"
        names: "c"
        struct {
          types {
            bool {
              nullability: NULLABILITY_REQUIRED
            }
          }
          types {
            struct {
              types {
                bool {
                  nullability: NULLABILITY_REQUIRED
                }
              }
            }
          }
          nullability: NULLABILITY_REQUIRED
        }
      }
      named_table {
        names: "t1"
      }
    }
  }
}
version {
  minor_number: 42
  patch_number: 1
}
